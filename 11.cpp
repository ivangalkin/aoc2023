#include <iostream>
#include <vector>
#include <array>
#include <set>
#include <iomanip>
#include <sstream>
#include <map>
#include <tuple>
#include <numeric>
#include <algorithm>

#ifdef NDEBUG
#undef NDEBUG
#endif

#include <assert.h>

#define ASSERT_EQ(a, b) \
   do { __typeof__ (a) _a = (a); \
       __typeof__ (b) _b = (b); \
     if (_a != _b)       \
     {                 \
       std::cout << _a << " != " << _b << std::endl; \
       assert(0);                  \
     }                  \
     }while(0)

#define myprint(arg) do { std::cout << "" #arg << " = " << arg << std::endl; } while(0)

using ll = int64_t;

namespace {

    std::vector<std::string> input_real{
            "...............#.......................................................#................#...................................................",
            "........#.............................................#...........................#.........................................................",
            ".....................................#......#................................................#......#......................................#",
            "...............................#...............................#.........................................#............................#.....",
            ".........................#.......................................................................................................#..........",
            ".............#.....................................#.......#.......#........................................................................",
            ".......................................................................................#...................................#................",
            "........................................................................#......#...................#........................................",
            "..........................................#.....................#..............................................#.......................#....",
            "....#...............#...................................#..............................................................#....................",
            "..............................#..........................................................#.................................................#",
            "................................................#...........................................................................................",
            "...........#........................#..................................................................#....................................",
            "...............................................................................#...............#...................#.......#................",
            ".....#.............#............#...........#..........................................................................................#....",
            "...........................#...........................................................................................#....................",
            "...........................................................................#................................................................",
            ".......................................................#......#.....................#.......................................................",
            "...#...........................................#.................................................................#..............#...........",
            "...............#...................#............................................................#..........................................#",
            ".......#................................................................#..................................#..............#..........#......",
            ".......................................#....................................................................................................",
            "......................#.....................#......................#........................................................................",
            "..............................................................................#........................#....................................",
            ".....#........................#.........................................................................................#.......#...........",
            "...................#........................................#...............................................................................",
            ".........#................#.........................#............#........................#....................#.....................#......",
            ".#..................................................................................#.......................................................",
            ".....................................................................#......#......................#........................#...............",
            "................#......................................#............................................................#.............#.........",
            ".....#................#......................#................#.............................................................................",
            "...............................#............................................................................................................",
            ".....................................#.........................................#........#.................#................................#",
            ".................................................................................................#..........................................",
            "...#........#...........................................#.........#................#.................................#......................",
            "...................................................................................................................................#........",
            "...................................................#...........................................................#...........#................",
            ".........................#..................#...............................#..........................#....................................",
            "...................#..........................................#.............................#............................................#..",
            ".......#..........................................................................................................#.........................",
            "..............................#......#..............................#............................#...................................#......",
            "..................................................................................#...........................#.........#...................",
            ".........................................................#..................................................................................",
            "............#....................#........#...............................#..............................#..................................",
            "...............................................#...................................................#..........................#.............",
            "............................................................#...............................................................................",
            "........................#.............................#...................................#.........................................#.......",
            "............................................................................................................................................",
            "........................................................................................................................#...................",
            "..................................................................#.........................................................................",
            "..............................................................................#...............................#.............................",
            ".............................#........#.....#...........#............................#...............#......................#...............",
            ".#............................................................#............................#..........................................#.....",
            "......................#.............................................#.......................................................................",
            "..............#.....................................#.......................................................................................",
            ".........................................#.....................................#.......................#....................................",
            "...............................#...............................................................................#.......#..................#.",
            "..#.......#.................................................................................................................................",
            "...................................#......................................................#...............#.................................",
            "...............................................#....................#...............................#.............................#.........",
            ".......................................................#....................#.....#............#............................................",
            ".............#........#.......................................#.............................................................................",
            ".......................................................................................................................#..............#.....",
            "............................................................................................................................................",
            "....#.....................#.........#.....................#..............#........................#.........................................",
            "..................#......................#......#...................#...................#.................#..............................#..",
            "..............................#...............................................................#.............................................",
            ".............................................................#......................................................#.......................",
            ".......................#.........................................................#........................................#.....#...........",
            "..........#.................................................................#...............................................................",
            "................#......................................................................#..........#.............#...........................",
            ".....#............................#...........#....................#..................................................................#.....",
            "......................................................#.....................................#...............#...............................",
            "..............................................................#.....................#....................................#.....#............",
            "........................................................................#..................................................................#",
            "..#........................#..............................#....................#............................................................",
            "............................................................................................................................................",
            ".........#........#.....................#.........................................................................#.........................",
            ".....................................................................................#....................................#.................",
            "............................................#..........#.....................#................#...........#.................................",
            "...................................................................#.................................................................#......",
            ".#................................................#.....................#...................................................................",
            "...............#......#.....#.............................#.........................................#.......................................",
            "............................................................................................................................................",
            "......#...........................#............................................................................................#............",
            ".......................................#....................................................#...........................#.................#.",
            "..................#.................................#...........#.........#........................................#........................",
            ".....................................................................#.........#............................................................",
            "...#..................#.......................#........................................................................................#....",
            "........................................................#.............................#.....................#...............................",
            "....................................#.............................................................#...............................#.........",
            ".........#.....#.............#............................................................................................#.................",
            "...........................................................................#...........................#.........#..........................",
            "....#....................#...................#..........................................#.............................................#.....",
            "...............................................................#...................#..........#.............................................",
            "...............................................................................................................................#............",
            ".................#......................................#...................................................................................",
            "...........................................#............................#.........................................#.........................",
            ".....................#...........................................................................#..........................#...............",
            "..............#.................#....................................................#.................................#....................",
            ".........#............................#...................................................#...........#...............................#.....",
            "...............................................................................................................#............................",
            "..................#...........................................#..................................................................#..........",
            ".......................................................................#...........#.....................#..................................",
            "............................................................................................................................................",
            "........................#.....................................................#............................................#................",
            ".................................#..........#.....#..........................................#..........................................#...",
            "...#...............................................................#.........................................#..............................",
            "..............#..........................................#...........................#..................................#.....#.............",
            ".......#..................................................................................#........................#........................",
            "...................................#........................................#...............................................................",
            "........................#...........................................................................#..........#............................",
            "...................................................#............................#.................................................#.........",
            ".........#..............................#...............#................#.............................................#..................#.",
            "#..............#.............#..........................................................#...................................................",
            ".............................................................#..............................................................................",
            ".........................#...........................#...........................................#...........#.....#........................",
            "............#..................................#............................................................................................",
            ".....................#..................................................................................................#...................",
            "............................#.................................................#..........................#..................................",
            ".......................................................#.........#..................#.........................................#.............",
            "....................................#.............#........................................#......................#.........................",
            "......................................................................................................#.....................................",
            ".............................................#..........................#...................................................................",
            ".........#.........................................................................................................................#.......#",
            "............................................................................................................................................",
            ".#............#..................#.............................................#..........#......#..........................................",
            ".......................#..........................#...................#...........................................#.........................",
            ".....#...............................................................................................#.......#...........#..................",
            ".......................................................#......#................................................................#........#...",
            "..........................#.................................................................................................................",
            "............................................................................................#...............................................",
            ".#.....#.........................#................................................................#.................#................#......",
            "....................................................#...................#.....#...........................................................#.",
            "......................#...............#..................#..........................#...........................#................#..........",
            ".................#............................................#.............................................................................",
            "..........................................#........................#...........................#.......#...................#................",
            ".....#...................#.......................................................#..........................................................",
            "...................................................#.................................................................#.................#....",
            "...........#......................#.........................#...............................#.....................................#........."
    };

    decltype(input_real) input_test{
            "...#......",
            ".......#..",
            "#.........",
            "..........",
            "......#...",
            ".#........",
            ".........#",
            "..........",
            ".......#..",
            "#...#.....",
    };
//    auto &input = input_test;
    auto &input = input_real;

    bool is_column_empty(const std::vector<std::string> &map, ll column) {
        for (ll y = 0; y < map.size(); y++) {
            if (map.at(y).at(column) == '#') return false;
        }
        return true;
    }

    bool is_row_empty(const std::vector<std::string> &map, ll row) {
        for (ll x = 0; x < map.at(row).size(); x++) {
            if (map.at(row).at(x) == '#') return false;
        }
        return true;
    }

    ll sum_min_dist(ll expansion) {
        ll result = 0;
        std::vector<ll> row_offsets(input.size(), 0);
        std::vector<ll> column_offsets(input.at(0).size(), 0);

        for (ll row = 0; row < input.size(); row++) {
            if (is_row_empty(input, row)) {
                for (ll e = row + 1; e < input.size(); e++) {
                    row_offsets.at(e) += (expansion - 1);
                }
            }
        }
        for (ll column = 0; column < input.at(0).size(); column++) {
            if (is_column_empty(input, column)) {
                for (ll e = column + 1; e < input.at(0).size(); e++) {
                    column_offsets.at(e) += (expansion - 1);
                }
            }
        }


        std::vector<std::tuple<ll, ll>> galaxies;
        for (ll y = 0; y < input.size(); y++) {
            for (ll x = 0; x < input.at(y).size(); x++) {
                if (input.at(y).at(x) == '#') {
                    galaxies.push_back({x + column_offsets.at(x), y + row_offsets.at(y)});
                }
            }
        }

        for (ll g0 = 0; g0 < galaxies.size() - 1; g0++) {
            for (ll g1 = g0 + 1; g1 < galaxies.size(); g1++) {
                auto [x0, y0] = galaxies.at(g0);
                auto [x1, y1] = galaxies.at(g1);
                const ll shortest_path = llabs(x1 - x0) + llabs(y1 - y0);
                result += shortest_path;
            }
        }

        return result;
    }
}

int main11() {
    int64_t result0 = sum_min_dist(2);
    int64_t result1 = sum_min_dist(1000000);

    ASSERT_EQ(result0, 9647174);
    ASSERT_EQ(result1, 377318892554);

    return 0;
}
